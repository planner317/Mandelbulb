<!DOCTYPE html>
<html lang="en-US" class="no-js">

<head>
    <title>MengerBulb</title>


    <script id="shader-vs" type="x-shader/x-vertex">#version 300 es   
  layout (location = 2) in vec2 vPos;
  void main(void) {
  gl_Position = vec4(vPos, 0., 1.);
}
</script>

    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700,400italic,600italic,700italic'
        rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../../jsLib/slider/slider.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="../../jsLib/tools.css" media="screen" />

    <script type="text/javascript">
        /** @type{WebGL2RenderingContext} */
        var ctxGL = null;
        var progM = null;
        var progFB = null;
        var canvasM = null;
        var leftArcBall = null;
        var rightArcBall = null;
        var Zoom = 0.5;
        var phongMethod = -1.0;
        var oldMousePos = { x: 0.0, y: 0.0 };
        var panPosition = { x: 0.0, y: 0.0 };
        var palTexture;
        var fb = { fb: 0, tex: 0, w: 0, h: 0, build: false };
        let stepRender = 10;
        let stepVAO = new Array(stepRender);

        var timerFullRender = 0;

        //checkBox options    
        var useShadow = false;
        var invertPalette = false;
        var useAO = false;
        var antiAlias = false;

        var vao, vaoBuff;

        var isToolsOpened = false;
        var isTools2Opened = false;
        var isLMouseDown = false;
        let isCMouseDown = false;
        var isRMouseDown = false;

        var mTransp = { x: -0.75, y: 0.0 };
        var mScale = { x: 1.5, y: 1.5 };
        var mStepScale = 1.0;
        var mousePos = { x: 2.9645, y: 0.0 };

        var zoomPixel = [
            1.0, 2.0, 4.0, 6.0
        ];

        var uniformNames = [
            "lightIntensity",
            "diffIntensity",
            "specularComponent",
            "specularExponent",
            "ambientLight",
            "normalComponent",
            "shadowDensity", "shadowDarkness", "shadowIterations",
            "aoMult", "aoSub",
            "maxDetailIter",
            "epsilon",
            "gamma",
            "paletteOffset"
        ];

        var uniformNames2 = [
            "offX", "offY", "offZ",
            "rotX", "rotY", "rotZ",  // single call rotation -> angle (DEG) & unit Vec3 axis components [0,1]
            "incX", "incY", "incZ",
            "scaleX", "scaleY", "scaleZ",
            "spongeIterations",
            "Power",
            "maxIterations",
            "moffX", "moffY", "moffZ",
            "mmix",
        ];



    </script>

    <script type="text/javascript" src="../../jsLib/gl-matrix/common.js"></script>
    <script type="text/javascript" src="../../jsLib/gl-matrix/vec3.js"></script>
    <script type="text/javascript" src="../../jsLib/gl-matrix/vec2.js"></script>
    <script type="text/javascript" src="../../jsLib/gl-matrix/vec4.js"></script>
    <script type="text/javascript" src="../../jsLib/gl-matrix/quat.js"></script>
    <script type="text/javascript" src="../../jsLib/gl-matrix/mat3.js"></script>
    <script type="text/javascript" src="../../jsLib/gl-matrix/mat4.js"></script>
    <script type="text/javascript" src="../../jsLib/arcBall.js"></script>

    <script type="text/javascript" src="../../jsLib/slider/slider.js"></script>

    <script type="text/javascript" src="../../jsLib/palettes/magma.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/parula.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/action.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/aranblue.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/bsvroy.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/colouredSky.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/inferno.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/phase.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/spectral.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/viridis.js"> </script>
    <script type="text/javascript" src="../../jsLib/palettes/white.js"> </script>

    <script type="text/javascript">

        var palArray = [
            { name: 'action', value: palAction },
            { name: 'magma ', value: palMagma },
            { name: 'parula', value: palParula },
            { name: 'aranblue', value: palAranblue },
            { name: 'bsvroy', value: palBsvroy },
            { name: 'colouredSky', value: palColouredSky },
            { name: 'inferno', value: palInferno },
            { name: 'phase', value: palPhase },
            { name: 'spectral', value: palSpectral },
            { name: 'viridis', value: palViridis },
            { name: 'white', value: palVirus }
        ];

        function textureFromArray(ctx, dataArray, type, width, height, init) {
            var dataTypedArray = new Float32Array(width * 2 * 3); // Don't need to do this if the data is already in a typed array

            //using: pal + inverse(pal) to create one endless smooth palette
            for (var k = 0; k < width; k++) {
                var i = k * 3;
                var j = (width - 1) * 2 * 3 - i;
                dataTypedArray[j] = dataTypedArray[i] = dataArray[i];
                dataTypedArray[j + 1] = dataTypedArray[i + 1] = dataArray[i + 1];
                dataTypedArray[j + 2] = dataTypedArray[i + 2] = dataArray[i + 2];
            }


            //var palTexture;
            if (init) palTexture = ctx.createTexture();
            //ctx.activeTexture(ctx.TEXTURE0+texture);
            ctx.bindTexture(ctx.TEXTURE_2D, palTexture);
            ctx.texImage2D(ctx.TEXTURE_2D, 0, ctx.RGB16F, width * 2, height, 0, ctx.RGB, ctx.FLOAT, dataTypedArray);
            ctx.texParameteri(ctx.TEXTURE_2D, ctx.TEXTURE_MAG_FILTER, ctx.LINEAR);
            ctx.texParameteri(ctx.TEXTURE_2D, ctx.TEXTURE_MIN_FILTER, ctx.LINEAR);
            // Other texture setup here, like filter modes and mipmap generation
            return palTexture
        }

        function getShader(gl, id) {
            var shaderScript = document.getElementById(id);
            var str = "";
            var k = shaderScript.firstChild;
            while (k) {
                if (k.nodeType == 3) str += k.textContent;
                k = k.nextSibling;
            }
            var shader;
            if (shaderScript.type == "x-shader/x-fragment")
                shader = gl.createShader(gl.FRAGMENT_SHADER);
            else if (shaderScript.type == "x-shader/x-vertex")
                shader = gl.createShader(gl.VERTEX_SHADER);
            else return null;
            gl.shaderSource(shader, str);
            gl.compileShader(shader);
            if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) == 0)
                alert(gl.getShaderInfoLog(shader));


            return shader;
        }

        function getShaderFromFile(gl, url, type) {
            var req = new XMLHttpRequest();
            req.open("GET", url, false);
            req.send(null);

            var shader = null;
            if (req.status == 200 || req.status == 0) {

                shader = gl.createShader(type);

                gl.shaderSource(shader, req.responseText);

                gl.compileShader(shader);
                if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) == 0)
                    alert(gl.getShaderInfoLog(shader));
            }

            return shader;
        }

        var controls = [];
        var controls2 = [];


        function render(isFullRender) {
            var element = document.getElementById("waitButt");
            let maxIterations = +DOMmaxIterations.innerHTML;
            let epsilon = +DOMepsilon.innerHTML;
            if (typeof (isFullRender) === "undefined") {
                ctxGL.uniform1i(ctxGL.getUniformLocation(progM, "useShadow"), useShadow);
                ctxGL.uniform1f(ctxGL.getUniformLocation(progM, "maxIterations"), maxIterations);
                ctxGL.uniform1f(ctxGL.getUniformLocation(progM, "epsilon"), epsilon);
                ctxGL.uniform1f(ctxGL.getUniformLocation(progM, "AA"), 1.0);
                isFullRender = false;
                element.setAttribute("style", "color: #ff0000;");
            }
            else {
                ctxGL.uniform1i(ctxGL.getUniformLocation(progM, "useShadow"), true);
                ctxGL.uniform1f(ctxGL.getUniformLocation(progM, "maxIterations"), 10);
                ctxGL.uniform1f(ctxGL.getUniformLocation(progM, "epsilon"), 0.0001);
                ctxGL.uniform1f(ctxGL.getUniformLocation(progM, "AA"), 2.0);
            }

            var w = canvasM.width, h = canvasM.height;
            log.innerHTML = w + " x " + h
            ctxGL.viewport(0, 0, w, h);


            ctxGL.bindTexture(ctxGL.TEXTURE_2D, palTexture);

            //var i = document.getElementById("screenDef").selectedIndex;

            var maxRes = w > h ? w : h;
            
            ctxGL.uniform1i(ctxGL.getUniformLocation(progM, "useAO"), useAO);
            ctxGL.uniform4f(ctxGL.getUniformLocation(progM, "resolution"), w, h, w / maxRes, h / maxRes);
            ctxGL.uniform2f(ctxGL.getUniformLocation(progM, "panPosition"), panPosition.x / window.innerWidth, panPosition.y / window.innerHeight);
            ctxGL.uniform1i(ctxGL.getUniformLocation(progM, "invertPalette"), invertPalette);

            var world = mat3.create();
            leftArcBall.rotation(world);

            var vZoom = vec3.fromValues(Zoom, Zoom, Zoom);
            var mZoom = mat3.create();
            mat3.scale(mZoom, mZoom, vZoom);
            mat3.multiply(world, world, mZoom);
            mat3.invert(world, world);

            ctxGL.uniformMatrix3fv(ctxGL.getUniformLocation(progM, "Orientation"), false, world);

            var vLight = vec3.fromValues(1, 1, 1);
            var mLightRot = mat3.create();
            rightArcBall.rotation(mLightRot);


            mat3.mulVec3(vLight, mLightRot, vLight);
            vec3.scale(vLight, vLight, 3.0);

            ctxGL.uniform3f(ctxGL.getUniformLocation(progM, "Light"), vLight[0], vLight[1], vLight[2]);



            if (isFullRender) {
                element.setAttribute("style", "color: #00ff00;");
                finalRender();
            }
            else {
                for (let i = 0; i < stepRender; i++) {
                    ctxGL.bindVertexArray(stepVAO[i]);
                    ctxGL.drawArrays(ctxGL.TRIANGLE_STRIP, 0, 10);
                }
            }
        }
        let sessia = 0;
        function finalRender() {
            let i = 0;
            sessia++;
            let thisSesia = sessia;
            function draw() {
                ctxGL.bindVertexArray(stepVAO[i]);
                ctxGL.drawArrays(ctxGL.TRIANGLE_STRIP, 0, 10);
                i++;
                if (i < stepRender && thisSesia == sessia) requestAnimationFrame(draw);
            }
            draw();

        }
        function setFrameBuffer(gl, width, height) {
            fb.w = width; fb.h = height;

            if (!fb.buld) {
                fb.fb = gl.createFramebuffer();
                //target.renderbuffer = gl.createRenderbuffer();
                fb.tex = gl.createTexture();
            } else {
                gl.deleteFramebuffer(fb.fb);
                fb.fb = gl.createFramebuffer();
            }
            // set up framebuffer
            gl.bindTexture(gl.TEXTURE_2D, fb.tex);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
            if (!fb.buld) {
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
            }
            gl.bindFramebuffer(gl.FRAMEBUFFER, fb.fb);
            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, fb.tex, 0);
            // set up renderbuffer
            //gl.bindRenderbuffer( gl.RENDERBUFFER, target.renderbuffer );
            //gl.renderbufferStorage( gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height );
            //gl.framebufferRenderbuffer( gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, target.renderbuffer );
            // clean up
            gl.bindTexture(gl.TEXTURE_2D, null);
            //gl.bindRenderbuffer( gl.RENDERBUFFER, null );
            gl.bindFramebuffer(gl.FRAMEBUFFER, null);

            fb.buld = true;
        }

        function onResize() {

            var i = document.getElementById("screenDef").selectedIndex;

            var w = window.innerWidth / zoomPixel[i], h = window.innerHeight / zoomPixel[i];
            //setFrameBuffer(ctxGL, w, h);

            canvasM.width = w; //  / .5
            canvasM.height = h; //   / .5
            canvasM.style.width = window.innerWidth + 'px';
            canvasM.style.height = window.innerHeight + 'px';

            //ctxGL.viewport(0, 0, canvasM.width, canvasM.height);

            leftArcBall.setWindowSize(window.innerWidth, window.innerHeight);
            rightArcBall.setWindowSize(window.innerWidth, window.innerHeight);

            if (progM) render();
        }



        function getMousePos(canvas, evt) {
            return {
                x: evt.clientX, // evt.clientX / window.innerWidth,
                y: evt.clientY // 1 - evt.clientY / window.innerHeight
            };
        }


        function windowTools() {
            if (isToolsOpened) { popupTools.style.display = "none"; isToolsOpened = false; }
            else { popupTools.style.display = "block"; isToolsOpened = true; }

        }
        function windowTools2() {
            if (isTools2Opened) { popupTools2.style.display = "none"; isTools2Opened = false; }
            else { popupTools2.style.display = "block"; isTools2Opened = true; }

        }

        function showTools() {////////////////////??????????
            /* display the pop-up */
            Popup.style.display = "block";
            /* set the pop-up's left */
            Popup.style.left = 10;
            /* set the pop-up's top */
            Popup.style.top = 10;
            isToolsOpened = true;
        }
        /* this function hides the pop-up when
        user moves the mouse out of the link */
        function hideTools() {
            /* hide the pop-up */
            Popup.style.display = "none";
            isToolsOpened = false;
        }

        function togglePhong() {
            phongMethod = document.getElementById('phongCheck').checked ? 1 : -1;
            render();

        }

        function toggleAO() {
            useAO = document.getElementById('aoCheck').checked;
            render();
        }
        function antiAliasFunc() {
            antiAlias = document.getElementById('antiAliasCheck').checked;
            render();
        }
        function toggleMandelBulb() {
            ctxGL.uniform1i(ctxGL.getUniformLocation(progM, "toggleMandelBulb"), DOMtoggleMandelBulb.checked);
            menuMandelBulb.classList.toggle("off", !DOMtoggleMandelBulb.checked)
            if (!DOMtoggleMandelBulb.checked && !DOMtoggleMengerSponge.checked) {
                DOMtoggleMengerSponge.checked = true;
                toggleMengerSponge(); return;
            }
            render();
        }
        function toggleMengerSponge() {
            ctxGL.uniform1i(ctxGL.getUniformLocation(progM, "toggleMengerSponge"), DOMtoggleMengerSponge.checked);
            menuMengerSponge.classList.toggle("off", !DOMtoggleMengerSponge.checked)
            if (!DOMtoggleMandelBulb.checked && !DOMtoggleMengerSponge.checked) {
                DOMtoggleMandelBulb.checked = true;
                toggleMandelBulb(); return;
            }
            render();
        }
        function toggleShadow() {
            useShadow = document.getElementById('shadowCheck').checked;
            render();
        }
        function invertPaletteFunc() {
            invertPalette = document.getElementById('invPalCheck').checked;
            render();
        }

        function palSelect() {
            var i = document.getElementById("comboPalette").selectedIndex;

            palTexture = textureFromArray(ctxGL, palArray[i].value, ctxGL.RGB, 256, 1, false);

            ctxGL.useProgram(progM);
            ctxGL.uniform1i(ctxGL.getUniformLocation(progM, "palette"), palTexture);
            //ctxGL.useProgram(null);

            render();
        }
        window.onkeydown = event => {
            if (event.code == "KeyR") render(true);
        }

        function webGLStart() {

            var controller;


            //Creo canvas su intera window
            /*
                var effect = document.createElement('div');
                document.body.appendChild(effect);
            
                canvasM = document.createElement('canvas');
                effect.appendChild(canvasM);
            */
            canvasM = document.createElement('canvas');
            canvasM.style.display = 'block';
            document.body.appendChild(canvasM);
            //canvasM = document.getElementById("canvas")

            //effect.style.position = 'relative';

            try {
                ctxGL = canvasM.getContext("webgl2", { alpha: false, stencil: false, antialias: true, depth: false, preserveDrawingBuffer: true }); //|| canvasM.getContext("experimental-webgl");
            } catch (e) { }
            if (!ctxGL) { alert("Can't get WebGL"); return; }

            //setFrameBuffer(ctxGL, window.innerWidth, window.innerHeight); 

            progM = ctxGL.createProgram();
            ctxGL.attachShader(progM, getShader(ctxGL, "shader-vs"));
            //ctxGL.attachShader(progM, getShader(ctxGL, "JulCosFS"));
            ctxGL.attachShader(progM, getShaderFromFile(ctxGL, "fragWGL.glsl", ctxGL.FRAGMENT_SHADER));
            //ctxGL.attachShader(progM, getShaderFromFile(ctxGL, "Mandel.glsl", ctxGL.FRAGMENT_SHADER));
            ctxGL.linkProgram(progM);
            ctxGL.useProgram(progM);

            var posAtrLocM = ctxGL.getAttribLocation(progM, "vPos");


            let outXY = 1 / stepRender;
            let innerXY = 0;
            for (let i = 0; i < stepRender; i++) {
                var verticesM = new Float32Array([
                    -outXY, outXY, -innerXY, innerXY, outXY, outXY, innerXY, innerXY,   // СВЕРХУ
                    outXY, -outXY, innerXY, -innerXY,                                   // СПРАВА
                    -outXY, -outXY, -innerXY, -innerXY,                                 // СНИЗУ
                    -outXY, outXY, -innerXY, innerXY,                                   // СЛЕВА
                ]);
                innerXY = outXY;
                outXY += 1 / stepRender;

                stepVAO[i] = ctxGL.createVertexArray();
                vaoBuff = ctxGL.createBuffer();
                ctxGL.bindBuffer(ctxGL.ARRAY_BUFFER, vaoBuff);
                ctxGL.bufferData(ctxGL.ARRAY_BUFFER, verticesM, ctxGL.STATIC_DRAW);

                ctxGL.bindVertexArray(stepVAO[i]);
                ctxGL.vertexAttribPointer(posAtrLocM, 2, ctxGL.FLOAT, false, 0, 0);
                ctxGL.enableVertexAttribArray(posAtrLocM);
                ctxGL.bindVertexArray(null);
            }

            palTexture = textureFromArray(ctxGL, palArray[0].value, ctxGL.RGB, 256, 1, true);
            ctxGL.uniform1i(ctxGL.getUniformLocation(progM, "palette"), palTexture);

            leftArcBall = new ArcBall();
            rightArcBall = new ArcBall();

            {
                var obj = document.getElementById('controls').getElementsByTagName('dd');

                var items = parseInt(obj.length / sliderComponents);
                for (var i = 0; i < items; i++) {
                    controls[controls.length] = new Slider(obj, i, uniformNames[i]);
                    //controls[i].oV.innerHTML = controls[i].value;
                }
            }
            {
                var obj = document.getElementById('controls2').getElementsByTagName('dd');

                var items = parseInt(obj.length / sliderComponents);
                for (var i = 0; i < items; i++) {
                    controls2[controls2.length] = new Slider(obj, i, uniformNames2[i]);
                    //controls[i].oV.innerHTML = controls[i].value;
                }
            }

            document.getElementById('aoCheck').checked = useAO;
            document.getElementById('shadowCheck').checked = useShadow;
            document.getElementById('invPalCheck').checked = invertPalette;
            //    document.getElementById('phongCheck').checked = phongMethod == -1 ? false : true; -


            window.addEventListener("resize", onWindowsResize, false);
            canvasM.addEventListener("pointermove", onPointerMove, false);

            canvasM.addEventListener("pointerdown", onPointerDown, false);
            canvasM.addEventListener("pointerup", onPointerUp, false);
            canvasM.addEventListener("pointerover", onPointerUp, false);
            canvasM.addEventListener("mousewheel", onMouseWheel, false);
            canvasM.addEventListener("DOMMouseScroll", onMouseWheel, false);

            function onWindowsResize(evt) { onResize(); }

            function onPointerDown(evt) {
                switch (evt.which) {
                    case 1:
                        isLMouseDown = true;
                        oldMousePos = getMousePos(canvasM, evt);
                        leftArcBall.start(evt.clientX, evt.clientY);
                        break;
                    case 2:
                        isCMouseDown = true;
                        oldMousePos = getMousePos(canvasM, evt);
                        break;
                    case 3:
                        isRMouseDown = true;
                        rightArcBall.start(evt.clientX, evt.clientY);
                        break;
                    default:
                }
                evt.preventDefault();
            }

            function onPointerUp(evt) {
                isLMouseDown = false;
                leftArcBall.stop();
                isCMouseDown = false;
                isRMouseDown = false;
                rightArcBall.stop();
            }

            function onPointerMove(evt) {
                if (isLMouseDown) {
                    mousePos = getMousePos(canvasM, evt);

                    if (evt.shiftKey) { panPosition.x += oldMousePos.x - mousePos.x; panPosition.y -= (oldMousePos.y - mousePos.y); }
                    else leftArcBall.drag(mousePos.x, mousePos.y);

                    render();
                    oldMousePos = mousePos;
                } else if (isRMouseDown) {
                    mousePos = getMousePos(canvasM, evt);
                    rightArcBall.drag(mousePos.x, mousePos.y);
                    render();
                } else if (isCMouseDown) {
                    mousePos = getMousePos(canvasM, evt);
                    Zoom += (mousePos.y - oldMousePos.y) * 0.001;
                    var maxZoom = 4.5;
                    var minZoom = .05;
                    Zoom = Zoom > maxZoom ? maxZoom : (Zoom < minZoom ? minZoom : Zoom);
                    render();
                    oldMousePos = getMousePos(canvasM, evt);
                }
            }


            function onMouseWheel(evt) {
                var maxZoom = 4.5;
                var minZoom = .05;
                var spin = evt.wheelDelta
                Zoom += .033 * Math.max(-1, Math.min(1, (evt.wheelDelta || -evt.detail)));
                Zoom = Zoom > maxZoom ? maxZoom : (Zoom < minZoom ? minZoom : Zoom);
                render();
            }

            //Fill and select combos    

            for (i = 0; i < zoomPixel.length; i++) {
                screenDef.appendChild(document.createElement("option")).text = zoomPixel[i];
            }
            document.getElementById("screenDef").selectedIndex = 1;

            for (i = 0; i < palArray.length; i++) {
                comboPalette.appendChild(document.createElement("option")).text = palArray[i].name;
            }
            document.getElementById("comboPalette").selectedIndex = 0;

            onResize();
            let w = window.innerWidth, h = innerHeight;
            leftArcBall.start(w / 2, h / 2); leftArcBall.drag(w / 2 + 200, h / 2 + 80); leftArcBall.stop();
            rightArcBall.start(w / 2, h / 2); rightArcBall.drag(w / 2 - 500, h / 2 ); rightArcBall.stop();
            ctxGL.uniform1i(ctxGL.getUniformLocation(progM, "toggleMandelBulb"), true);
            render()
        }
    </script>

</head>

<body onload="webGLStart();" oncontextmenu="return false;" style="color: #CCC; background-color: #000;">

    <div id="popupTools2" class="toolsWindow2" style="height:600px;" onpointerdown="return false;">
        <div class="toolsTitle"></div>
        <div id="controls2">
            <div class="clear"></div>
            <dl class="col">
                <p><input type="checkbox" id="DOMtoggleMengerSponge" 
                        oninput="toggleMengerSponge(event);">MengerSponge</p>
                <div id="menuMengerSponge" class="off">
                    <dt>OffsetX</dt>
                    <dd class="title">Red component</dd>
                    <dd>0.0</dd>
                    <dd>10.0</dd>
                    <dd>1.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>OffsetY</dt>
                    <dd class="title">Green component</dd>
                    <dd>0.0</dd>
                    <dd>10.0</dd>
                    <dd>1.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>OffsetZ</dt>
                    <dd class="title">Blue component</dd>
                    <dd>0.0</dd>
                    <dd>10.0</dd>
                    <dd>1.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>

                    <dt>uRotX</dt>
                    <dd class="title">Rotation on X</dd>
                    <dd>0.0</dd>
                    <dd>179.9</dd>
                    <dd>0.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title=""></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>uRotY</dt>
                    <dd class="title">Rotation on Y</dd>
                    <dd>0.0</dd>
                    <dd>179.9</dd>
                    <dd>0.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title=""></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>uRotZ</dt>
                    <dd class="title">Rotation on Z</dd>
                    <dd>0.0</dd>
                    <dd>179.9</dd>
                    <dd>0.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title=""></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>incX</dt>
                    <dd class="title">Red component</dd>
                    <dd>-3.0</dd>
                    <dd>3.0</dd>
                    <dd>0.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>incY</dt>
                    <dd class="title">Green component</dd>
                    <dd>-3.0</dd>
                    <dd>3.0</dd>
                    <dd>0.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>incZ</dt>
                    <dd class="title">Blue component</dd>
                    <dd>-3.0</dd>
                    <dd>3.0</dd>
                    <dd>0.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>scaleX</dt>
                    <dd class="title">Red component</dd>
                    <dd>0.0</dd>
                    <dd>10.0</dd>
                    <dd>3.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>scaleY</dt>
                    <dd class="title">Green component</dd>
                    <dd>0.0</dd>
                    <dd>10.0</dd>
                    <dd>3.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>scaleZ</dt>
                    <dd class="title">Blue component</dd>
                    <dd>0.0</dd>
                    <dd>10.0</dd>
                    <dd>3.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>spongeIterations</dt>
                    <dd class="title">max Iterations</dd>
                    <dd>1.0</dd>
                    <dd>30.0</dd>
                    <dd>2</dd>
                    <dd>0</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                </div>
                <p><input type="checkbox" checked id="DOMtoggleMandelBulb" oninput="toggleMandelBulb(event);">MandelBulb</p>
                <div id="menuMandelBulb">
                    <dt>Power</dt>
                    <dd class="title">MBulb power</dd>
                    <dd>1.0</dd>
                    <dd>25.0</dd>
                    <dd>3</dd>
                    <dd>1</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>maxIterations</dt>
                    <dd class="title">max Iterations</dd>
                    <dd id="DOMmaxIterations">0.0</dd>
                    <dd>50.0</dd>
                    <dd>2</dd>
                    <dd>0</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>OffsetX</dt>
                    <dd class="title"></dd>
                    <dd>-4.0</dd>
                    <dd>4.0</dd>
                    <dd>1.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>OffsetY</dt>
                    <dd class="title"></dd>
                    <dd>-4.0</dd>
                    <dd>4.0</dd>
                    <dd>1.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>OffsetZ</dt>
                    <dd class="title"></dd>
                    <dd>-4.0</dd>
                    <dd>4.0</dd>
                    <dd>1.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                    <dt>Mix</dt>
                    <dd class="title"></dd>
                    <dd>0.0</dd>
                    <dd>1.0</dd>
                    <dd>1.0</dd>
                    <dd>2</dd>
                    <dd class="control">
                        <div class="bar" title="Click to move here"></div>
                        <div class="slider" title=""></div>
                    </dd>
                </div>
            </dl>
        </div>
    </div>


    <div id="popupTools" class="toolsWindow" style="height:740px">
        <div class="toolsTitle">
            <p>Light/Rendering</p>
        </div>
        <div id="controls">
            <div class="clear"></div>
            <dl class="col">
                <dt>Light</dt>
                <dd class="title">Intensity</dd>
                <dd>0.0</dd>
                <dd>5.0</dd>
                <dd>.5</dd>
                <dd>2</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>Diffuse</dt>
                <dd class="title">Intensity</dd>
                <dd>0.0</dd>
                <dd>10.0</dd>
                <dd>1.0</dd>
                <dd>2</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>Specular</dt>
                <dd class="title">Intensity</dd>
                <dd>0.0</dd>
                <dd>2.0</dd>
                <dd>.5</dd>
                <dd>2</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>Specular</dt>
                <dd class="title">exponent</dd>
                <dd>0.1</dd>
                <dd>150.0</dd>
                <dd>20.0</dd>
                <dd>2</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>Ambient</dt>
                <dd class="title">Ambielnt int.</dd>
                <dd>0.</dd>
                <dd>2.0</dd>
                <dd>0.01</dd>
                <dd>2</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>Normal</dt>
                <dd class="title">color variation</dd>
                <dd>0.0</dd>
                <dd>4.0</dd>
                <dd>2.0</dd>
                <dd>2</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <p>Shadows / AmbientOcclusion</p>
                <dt>Density</dt>
                <dd class="title">soft <-> sharp</dd>
                <dd>0.1</dd>
                <dd>250.0</dd>
                <dd>50.0</dd>
                <dd>1</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>Darkness</dt>
                <dd class="title">Light <-> Dark</dd>
                <dd>0.5</dd>
                <dd>1.0</dd>
                <dd>.95</dd>
                <dd>2</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>Deep</dt>
                <dd class="title">Iterations</dd>
                <dd>16</dd>
                <dd>256</dd>
                <dd>256</dd>
                <dd>0</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>AO mult</dt>
                <dd class="title">aoMult</dd>
                <dd>0.0</dd>
                <dd>5.0</dd>
                <dd>2.7</dd>
                <dd>2</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>AO sub</dt>
                <dd class="title">aoSub</dd>
                <dd>0.0</dd>
                <dd>2.0</dd>
                <dd>2.0</dd>
                <dd>2</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <p>Rendering details</p>
                <dt>maxDetailIter</dt>
                <dd class="title">max Detail</dd>
                <dd>100.0</dd>
                <dd>3000.0</dd>
                <dd>300.0</dd>
                <dd>0</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider" title=""></div>
                </dd>
                <dt>Epsilon</dt>
                <dd class="title">epsilon</dd>
                <dd id="DOMepsilon">.00001</dd>
                <dd>.01</dd>
                <dd>0.003</dd>
                <dd>6</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider"></div>
                </dd>
                <dt>Gamma</dt>
                <dd class="title">gamma correction</dd>
                <dd>0.5</dd>
                <dd>4.0</dd>
                <dd>1.6</dd>
                <dd>3</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider"></div>
                </dd>
                <dt>Palette</dt>
                <dd class="title">offset</dd>
                <dd>0.0</dd>
                <dd>1.0</dd>
                <dd>0.0</dd>
                <dd>3</dd>
                <dd class="control">
                    <div class="bar" title="Click to move here"></div>
                    <div class="slider"></div>
                </dd>

                <dt>
                    <input type="checkbox" id="aoCheck" onchange="toggleAO()"></input> Ambient Occlusion
                </dt>
                <dt>
                    <input type="checkbox" id="shadowCheck" onchange="toggleShadow()"></input> Shadows
                </dt>
                <dt>
                    <input type="checkbox" id="invPalCheck" onchange="invertPaletteFunc()"></input> Invert Palette
                </dt>
                <dt>
                    <input type="checkbox" id="antiAliasCheck" onchange="antiAliasFunc()"></input> Anti Alias
                </dt>

            </dl>


        </div>

        <div id="cmbScreen" style="bottom: 40px;">
            <b>Palettes </b>
            <select id="comboPalette" onchange="palSelect()"></select>
        </div>
        <div id="cmbScreen">
            <select id="screenDef" onchange="onResize()"></select> pixel subdivision
            <b id="log" style="font-size: 15px; color: cornflowerblue;"></b>
        </div>
        

    </div>

    <div id="tools">
        <div id="tools" title="open tools menu" onclick="windowTools()">&#10043;</div>
    </div>
    <div id="waitButt">&#9679;</div>

    <div id="toolsGen">
        <div id="toolsGen" title="open tools menu" onclick="windowTools2()">&#10044;</div>
    </div>

    <div id="faq" onclick="alert(
        `ЛКМ: вращать камеру
ПКМ: вращать свет
СКМ: зум
Shift + ПКМ: сместить камеру
R: render
F11: полный экран`)">?</div>
</body>

</html>